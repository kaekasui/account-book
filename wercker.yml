box: wercker/rvm
services:
  - wercker/mysql
build:
  steps:
    - bundle-install
    - rails-database-yml
    - script:
        name: Set up DB
        code: RAILS_ENV=test bundle exec rake db:schema:load
  after-steps:
    - hipchat-notify:
        token: $HIPCHAT_TOKEN
        room-id: 1295388
deploy:
  steps:
    - heroku-deploy:
        key-name: HEROKU_SSH_KEY
    - script:
        name: heroku maintenance
        code: |-
          heroku maintenance:on --app ENV['APP_NAME']
          heroku run rake db:migrate --app ENV['APP_NAME']
